"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e;const t=exports.Attend;let o=exports.employees;delete exports.employees;let l=o;const n=exports.employeeNumberRegularExpression,r=exports.selfService;function s(e){var t;e.preventDefault();const o=null===(t=e.currentTarget.closest(".columns"))||void 0===t?void 0:t.querySelectorAll("input");if(2!==o.length)return;const l=o.item(0).value;o.item(0).value=o.item(1).value,o.item(1).value=l}function a(e){let l,n;const a=o.find(t=>t.employeeNumber===e);let i=[];function u(o){var l,n;const r=o.currentTarget.closest("tr"),s=null==r?void 0:r.dataset.propertyName,a=null===(l=null==r?void 0:r.querySelector("input"))||void 0===l?void 0:l.value,u=null===(n=null==r?void 0:r.querySelector("select"))||void 0===n?void 0:n.value;cityssm.postJSON(`${t.urlPrefix}/admin/doUpdateEmployeeProperty`,{employeeNumber:e,propertyName:s,propertyValue:a,isSynced:u},e=>{const t=e;t.success&&(bulmaJS.alert({message:"Property updated successfully.",contextualColorName:"success"}),i=t.employeeProperties)})}function c(o){const l=o.currentTarget.closest("tr");bulmaJS.confirm({title:"Delete Employee Property",message:"Are you sure you want to remove this employee property?",contextualColorName:"warning",okButton:{text:"Delete Property",callbackFunction:function(){var o,n;const r=null==l?void 0:l.dataset.propertyName,s=null===(o=null==l?void 0:l.querySelector("input"))||void 0===o?void 0:o.value,a=null===(n=null==l?void 0:l.querySelector("select"))||void 0===n?void 0:n.value;cityssm.postJSON(`${t.urlPrefix}/admin/doDeleteEmployeeProperty`,{employeeNumber:e,propertyName:r,propertyValue:s,isSynced:a},e=>{const t=e;t.success&&(bulmaJS.alert({message:"Property deleted successfully.",contextualColorName:"success"}),i=t.employeeProperties,null==l||l.remove())})}}})}function d(){var e,t;const o=l.querySelector("#employeePropertyTab--current tbody");o.innerHTML="";for(const l of i){const n=document.createElement("tr");n.dataset.propertyName=l.propertyName,n.innerHTML=`<td class="is-size-7 is-vcentered">${l.propertyName}</td>\n          <td>\n            <div class="control">\n              <input class="input is-small" name="propertyValue" type="text" maxlength="500" />\n            </div>\n          </td>\n          <td>\n            <div class="control">\n            <div class="select is-small is-fullwidth">\n              <select name="isSynced">\n                <option value="1">Synced</option>\n                <option value="0">Not Synced</option>\n              </select>\n            </div>\n            </div>\n          </td>\n          <td class="has-text-right">\n          <div class="field is-grouped is-justify-content-flex-end">\n            <div class="control">\n            <button class="button is-update-button is-success is-small" data-tooltip="Save" type="button" aria-label="Save">\n              <i class="fas fa-save" aria-hidden="true"></i>\n            </button>\n            </div>\n            <div class="control">\n            <button class="button is-delete-button is-danger is-small" data-tooltip="Delete" type="button" aria-label="Delete">\n              <i class="fas fa-trash" aria-hidden="true"></i>\n            </button>\n            </div>\n          </div>\n          </td>`,n.querySelector("input").value=l.propertyValue,n.querySelector("select").value=l.isSynced?"1":"0",null===(e=n.querySelector(".is-update-button"))||void 0===e||e.addEventListener("click",u),null===(t=n.querySelector(".is-delete-button"))||void 0===t||t.addEventListener("click",c),o.append(n)}}function m(e){e.preventDefault();const o=e.currentTarget;cityssm.postJSON(`${t.urlPrefix}/admin/doAddEmployeeProperty`,o,e=>{var t;const n=e;n.success?(bulmaJS.alert({message:"Property added successfully.",contextualColorName:"success",okButton:{callbackFunction(){l.querySelector("#employeePropertyAdd--propertyName").focus()}}}),o.reset(),i=null!==(t=n.employeeProperties)&&void 0!==t?t:[],d()):bulmaJS.alert({title:"Error Adding Property",message:"The property may already be set. Please check, then try again.",contextualColorName:"danger"})})}function p(e){e.preventDefault(),cityssm.postJSON(`${t.urlPrefix}/admin/doUpdateEmployee`,e.currentTarget,e=>{const t=e;t.success&&(bulmaJS.alert({message:"Employee updated successfully.",contextualColorName:"success"}),o=t.employees,S())})}function y(l){l.preventDefault(),bulmaJS.confirm({title:"Delete Employee",message:"Are you sure you want to delete this employee?<br />\n          Note that if the employee is found in a subsequent syncing process, they may be restored.",messageIsHtml:!0,contextualColorName:"warning",okButton:{text:"Yes, Delete Employee",callbackFunction:function(){cityssm.postJSON(`${t.urlPrefix}/admin/doDeleteEmployee`,{employeeNumber:e},e=>{const t=e;t.success&&(n(),bulmaJS.alert({message:"Employee deleted successfully",contextualColorName:"info"}),o=t.employees,S())})}}})}cityssm.openHtmlModal("employeeAdmin-employee",{onshow(o){var n,s,u,c,m,p,y,v,b;l=o,o.querySelector(".modal-card-title").textContent=`${a.employeeSurname}, ${a.employeeGivenName}`,o.querySelector("#employeeEdit--employeeNumber").value=a.employeeNumber,o.querySelector("#employeeEdit--employeeNumberSpan").textContent=a.employeeNumber,o.querySelector("#employeeEdit--isActive").value=a.isActive?"1":"0",o.querySelector("#employeeEdit--isSynced").value=a.isSynced?"1":"0",o.querySelector("#employeeEdit--employeeSurname").value=a.employeeSurname,o.querySelector("#employeeEdit--employeeGivenName").value=a.employeeGivenName,o.querySelector("#employeeEdit--jobTitle").value=null!==(n=a.jobTitle)&&void 0!==n?n:"",o.querySelector("#employeeEdit--userName").value=null!==(s=a.userName)&&void 0!==s?s:"",o.querySelector("#employeeEdit--department").value=null!==(u=a.department)&&void 0!==u?u:"",""!==(null!==(c=a.seniorityDateTime)&&void 0!==c?c:"")&&(o.querySelector("#employeeEdit--seniorityDateTime").valueAsDate=new Date(a.seniorityDateTime)),o.querySelector("#employeeEdit--syncContacts").value=a.syncContacts?"1":"0",o.querySelector("#employeeEdit--workContact1").value=null!==(m=a.workContact1)&&void 0!==m?m:"",o.querySelector("#employeeEdit--workContact2").value=null!==(p=a.workContact2)&&void 0!==p?p:"",r&&(null===(y=o.querySelector(".is-self-service-message"))||void 0===y||y.classList.remove("is-hidden")),o.querySelector("#employeeEdit--homeContact1").value=null!==(v=a.homeContact1)&&void 0!==v?v:"",o.querySelector("#employeeEdit--homeContact2").value=null!==(b=a.homeContact2)&&void 0!==b?b:"",o.querySelector("#employeePropertyAdd--employeeNumber").value=a.employeeNumber,cityssm.postJSON(`${t.urlPrefix}/admin/doGetEmployeeProperties`,{employeeNumber:e},e=>{i=e.employeeProperties,d()})},onshown(e,o){var l,r,a;n=o,bulmaJS.toggleHtmlClipped(),bulmaJS.init(e),t.initializeMenuTabs(e.querySelectorAll(".menu a"),e.querySelectorAll(".tabs-container > article")),null===(l=e.querySelector("#form--employeeEdit"))||void 0===l||l.addEventListener("submit",p);const i=e.querySelectorAll(".is-swap-button");for(const e of i)e.addEventListener("click",s);null===(r=e.querySelector("#form--employeePropertyAdd"))||void 0===r||r.addEventListener("submit",m),null===(a=e.querySelector(".is-delete-employee"))||void 0===a||a.addEventListener("click",y)},onremoved(){bulmaJS.toggleHtmlClipped()}})}function i(e){e.preventDefault(),a(e.currentTarget.dataset.employeeNumber)}null===(e=document.querySelector("#is-add-employee-button"))||void 0===e||e.addEventListener("click",()=>{let e;function l(l){l.preventDefault(),cityssm.postJSON(`${t.urlPrefix}/admin/doAddEmployee`,l.currentTarget,t=>{const l=t;l.success?(e(),bulmaJS.alert({message:"Employee added successfully.",okButton:{callbackFunction(){a(l.employeeNumber)}}}),o=l.employees,S()):bulmaJS.alert({title:"Error Adding Employee",message:"Please check to make sure that an employee does not already exist with the same employee number.",contextualColorName:"danger"})})}cityssm.openHtmlModal("employeeAdmin-addEmployee",{onshown(t,o){var r;e=o,bulmaJS.toggleHtmlClipped();const s=t.querySelector("#employeeAdd--employeeNumber");void 0!==n&&(s.pattern=n.source),s.focus(),null===(r=t.querySelector("form"))||void 0===r||r.addEventListener("submit",l)},onremoved(){bulmaJS.toggleHtmlClipped()}})});const u=document.querySelector("#employeeSearch--employeeNameNumber"),c=document.querySelector("#employeeSearch--isActive"),d=document.querySelector("#container--employees"),m=50;let p=0;function y(){var e,t,o,n;if(0===l.length)return void(d.innerHTML='<div class="message is-info">\n        <p class="message-body">There are no employees that meet your search criteria.</p>\n        </div>');const r=document.createElement("div");r.className="panel";for(let o=p;o<Math.min(m+p,l.length);o+=1){const n=l[o],s=document.createElement("a");s.className="panel-block is-block",n.isActive||s.classList.add("is-italic","has-background-warning-light"),s.href="#",s.dataset.employeeNumber=null!==(e=n.employeeNumber)&&void 0!==e?e:"",s.innerHTML=`<div class="columns is-mobile">\n        <div class="column is-narrow">\n          <i class="fas fa-hard-hat" aria-hidden="true"></i>\n        </div>\n        <div class="column is-4">${n.employeeNumber}</div>\n        <div class="column">\n          ${n.employeeSurname}, ${n.employeeGivenName}<br />\n          <span class="is-size-7">\n            ${null!==(t=n.jobTitle)&&void 0!==t?t:""}\n          </span>\n        </div>\n        </div>`,s.addEventListener("click",i),r.append(s)}d.innerHTML="",d.append(r);const s=document.createElement("div");s.className="field is-grouped is-justify-content-center",s.innerHTML='<div class="control">\n      <button class="button is-previous-button" data-tooltip="Previous Employees" type="button" aria-label="Previous">\n        <i class="fas fa-arrow-left" aria-hidden="true"></i>\n      </button>\n      <button class="button is-next-button" data-tooltip="Next Employees" type="button" aria-label="Next">\n        <span>Next</span>  \n        <span class="icon is-small"><i class="fas fa-arrow-right" aria-hidden="true"></i></span>\n      </button>\n      </div>',0===p?s.querySelector(".is-previous-button").disabled=!0:null===(o=s.querySelector(".is-previous-button"))||void 0===o||o.addEventListener("click",v),m+p>=l.length?s.querySelector(".is-next-button").disabled=!0:null===(n=s.querySelector(".is-next-button"))||void 0===n||n.addEventListener("click",b),d.append(s)}function v(){p=Math.max(p-m,0),d.scrollIntoView(!0),window.scrollTo({top:window.scrollY-60}),y()}function b(){(p+=m)>=l.length&&(p=0),d.scrollIntoView(!0),window.scrollTo({top:window.scrollY-60}),y()}function S(){l=o.filter(e=>{if("1"===c.value&&!e.isActive||"0"===c.value&&e.isActive)return!1;const t=`${e.employeeGivenName} ${e.employeeSurname} ${e.employeeNumber}`.toLowerCase(),o=u.value.trim().toLowerCase().split(" ");for(const e of o)if(!t.includes(e))return!1;return!0}),y()}function f(){p=0,S()}f(),u.addEventListener("keyup",f),c.addEventListener("change",f)})();