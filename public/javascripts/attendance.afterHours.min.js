"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e;const t=exports.Attend,o=exports.afterHoursReasons,r=exports.employees;let n=exports.afterHoursRecords;const s=exports.employeeNumberRegularExpression;function a(e){const o=e.currentTarget.closest(".panel-block").dataset.recordId;bulmaJS.confirm({title:"Delete After Hours Record",message:"Are you sure you want to delete this after hours record?",contextualColorName:"warning",okButton:{text:"Yes, Delete Record",callbackFunction:function(){cityssm.postJSON(`${t.urlPrefix}/attendance/doDeleteAfterHoursRecord`,{recordId:o},e=>{const t=e;t.success?(bulmaJS.alert({message:"After hours record deleted successfully.",contextualColorName:"success"}),n=t.afterHoursRecords,l()):bulmaJS.alert({title:"Error Deleting Record",message:"Please try again.",contextualColorName:"danger"})})}}})}function l(){var e,t,o,r,s;const l=document.querySelector("#container--afterHours");if(null===l)return;if(0===n.length)return void(l.innerHTML='<div class="message is-info">\n        <p class="message-body">There are no recent after hours records to show.</p>\n        </div>');const c=document.createElement("div");c.className="panel";let u=0;for(const l of n){const n=new Date(l.attendanceDateTime),d=document.createElement("div");d.className="panel-block is-block",d.dataset.recordId=l.recordId,Date.now()-n.getTime()<=864e5&&(d.classList.add("has-background-success-light"),u+=1),d.tabIndex=0,d.innerHTML=`<div class="columns is-mobile">\n        <div class="column is-narrow">\n          <i class="fas fa-clock" aria-hidden="true"></i>\n        </div>\n        <div class="column is-3">\n          <strong data-tooltip="Attendance Date">\n            ${n.toLocaleDateString()}\n            </strong><br />\n            <span class="is-size-7">${n.toLocaleTimeString()}</span>\n        </div>\n        <div class="column is-4">\n          <strong>${l.employeeName}</strong><br />\n          <span class="is-size-7">${null!==(e=l.employeeNumber)&&void 0!==e?e:""}</span>\n        </div>\n        <div class="column">\n          <strong data-tooltip="Absence Type">${null!==(t=l.afterHoursReason)&&void 0!==t?t:""}</strong><br />\n          <span class="is-size-7">${null!==(o=l.recordComment)&&void 0!==o?o:""}</span>\n        </div>\n        </div>`,l.canUpdate&&(null===(r=d.querySelector(".columns"))||void 0===r||r.insertAdjacentHTML("beforeend",'<div class="column is-narrow">\n              <button class="button is-small is-inverted is-danger is-delete-button" data-cy="delete" type="button" aria-label="Delete Record">\n                <i class="fas fa-trash" aria-hidden="true"></i>\n              </button>\n            </div>'),null===(s=d.querySelector(".is-delete-button"))||void 0===s||s.addEventListener("click",a)),c.append(d)}l.innerHTML="",l.append(c),document.querySelector('#menu--attendance a[href="#tab--afterHours"] .tag').textContent=u.toString()}null===(e=document.querySelector(".is-new-after-hours-button"))||void 0===e||e.addEventListener("click",()=>{let e,a,c="";function u(){const t=e.querySelector("#afterHoursAdd--employeeNumber"),o=t.value.toLowerCase();if(o===c)return;c=o;const n=e.querySelector("#afterHoursAdd--employeeName");n.value="";const s=r.filter(e=>o.length>=e.employeeNumber.length/2&&e.employeeNumber.toLowerCase().endsWith(o));1===s.length&&(t.value=s[0].employeeNumber,c=s[0].employeeNumber.toLowerCase(),n.value=`${s[0].employeeGivenName} ${s[0].employeeSurname}`.trim())}function d(e){e.preventDefault(),cityssm.postJSON(`${t.urlPrefix}/attendance/doAddAfterHoursRecord`,e.currentTarget,e=>{const t=e;t.success&&(a(),bulmaJS.alert({message:"After hours attendance recorded successfully."}),n=t.afterHoursRecords,l())})}cityssm.openHtmlModal("afterHours-add",{onshow(t){e=t;const r=t.querySelector("#afterHoursAdd--afterHoursReasonId");for(const e of o){const t=document.createElement("option");t.value=e.afterHoursReasonId.toString(),t.textContent=e.afterHoursReason,r.append(t)}},onshown(e,t){var o;a=t,bulmaJS.toggleHtmlClipped(),null===(o=e.querySelector("form"))||void 0===o||o.addEventListener("submit",d);const r=e.querySelector("#afterHoursAdd--employeeNumber");void 0!==s&&(r.pattern=s.source),r.focus(),r.addEventListener("keyup",u)},onremoved(){bulmaJS.toggleHtmlClipped()}})}),l()})();