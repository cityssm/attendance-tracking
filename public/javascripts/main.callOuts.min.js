"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e,t,l,s,a,n;const o=exports.Attend;let i="",r=[],c=[],u=exports.callOutLists;function d(){var e;return null===(e=o.callOuts)||void 0===e?void 0:e.callOutLists.find(e=>e.listId===i)}const m=null!==(e=exports.callOutResponseTypes)&&void 0!==e?e:[],p=null!==(t=exports.employeeEligibilityFunctionNames)&&void 0!==t?t:[],v=null!==(l=exports.employeeSortKeyFunctionNames)&&void 0!==l?l:[],y="true"===(null===(s=document.querySelector("main"))||void 0===s?void 0:s.dataset.isAdmin),b=null!==(n=null===(a=document.querySelector("main"))||void 0===a?void 0:a.dataset.userName)&&void 0!==n?n:"",f=0!==m.length&&exports.userPermissions.callOutsCanUpdate,S=0!==p.length&&exports.userPermissions.callOutsCanManage;function O(e){e.preventDefault(),function e(t){const l=d();let s=0;const a=r.find((e,l)=>e.employeeNumber===t&&(s=l,!0)),n=c.find(e=>t===e.employeeNumber);let u,p;function v(e){e.preventDefault();const t=e.currentTarget;cityssm.postJSON(`${o.urlPrefix}/attendance/doAddCallOutRecord`,t,e=>{const l=e;l.success&&(bulmaJS.alert({message:"Call out recorded successfully.",contextualColorName:"success"}),t.reset(),p=l.callOutRecords,g())})}function S(e){e.preventDefault();const l=e.currentTarget.closest(".panel-block").dataset.recordId;bulmaJS.confirm({title:"Delete Call Out Record",message:"Are you sure you want to delete this call out record?",contextualColorName:"warning",okButton:{text:"Yes, Delete Record",callbackFunction:function(){cityssm.postJSON(`${o.urlPrefix}/attendance/doDeleteCallOutRecord`,{recordId:l,employeeNumber:t,listId:i},e=>{const t=e;t.success&&(bulmaJS.alert({message:"Call out record deleted successfully.",contextualColorName:"success"}),p=t.callOutRecords,g())})}}})}function O(e){let t;e.preventDefault();const l=e.currentTarget.closest(".panel-block").dataset.recordId;function s(e){e.preventDefault(),cityssm.postJSON(`${o.urlPrefix}/attendance/doUpdateCallOutRecord`,e.currentTarget,e=>{const l=e;l.success&&(t(),bulmaJS.alert({message:"Call out record updated successfully.",contextualColorName:"success"}),p=l.callOutRecords,g())})}const a=p.find(e=>e.recordId===l);if(void 0===a)return void bulmaJS.alert({title:"Call Out Record Unavailable",message:"Please refresh and try again.",contextualColorName:"danger"});const n=new Date(a.callOutDateTime);cityssm.openHtmlModal("callOutRecord-edit",{onshow(e){var t;e.querySelector("#callOutRecordEdit--recordId").value=a.recordId,e.querySelector("#callOutRecordEdit--listId").value=a.listId,e.querySelector("#callOutRecordEdit--employeeNumber").value=a.employeeNumber,e.querySelector("#callOutRecordEdit--callOutDateString").value=cityssm.dateToString(n),e.querySelector("#callOutRecordEdit--callOutTimeString").value=cityssm.dateToTimeString(n),e.querySelector("#callOutRecordEdit--natureOfCallOut").value=a.natureOfCallOut,e.querySelector("#callOutRecordEdit--callOutHours").value=a.callOutHours.toString();const l=e.querySelector("#callOutRecordEdit--responseTypeId");let s=!1;for(const e of m){const t=document.createElement("option");t.value=e.responseTypeId.toString(),t.textContent=e.responseType,a.responseTypeId===e.responseTypeId&&(s=!0),l.append(t)}if(!s){const e=document.createElement("option");e.value=a.responseTypeId.toString(),e.textContent=null!==(t=a.responseType)&&void 0!==t?t:`responseTypeId:${a.responseTypeId.toString()}`,l.append(e)}l.value=a.responseTypeId.toString(),e.querySelector("#callOutRecordEdit--recordComment").value=a.recordComment},onshown(e,l){var a;t=l,null===(a=e.querySelector("form"))||void 0===a||a.addEventListener("submit",s)}})}function g(){var e,t,l,s,a,n;u.querySelector("#tag--recentCalls").textContent=p.length.toString();const o=u.querySelector("#container--callOutRecords"),i=u.querySelector("#callOutListMember--callOutDateTimeMax");if(0===p.length)return o.innerHTML='<div class="message is-info">\n          <p class="message-body">There are no recent call outs to show.</p>\n          </div>',void(i.textContent="(No Recent Call Outs)");const r=document.createElement("div");r.className="panel";for(const[o,c]of p.entries()){const u=new Date(c.callOutDateTime);0===o&&(i.innerHTML=`${c.isSuccessful?'<i class="fas fa-fw fa-check has-text-success" aria-label="Yes"></i>':'<i class="fas fa-fw fa-times has-text-danger" aria-label="No"></i>'}\n            ${u.toLocaleDateString()} ${u.toLocaleTimeString()}`);const d=document.createElement("div");d.className="panel-block is-block",d.dataset.recordId=c.recordId,d.classList.add(c.isSuccessful?"has-background-success-light":"has-background-danger-light"),d.innerHTML=`<div class="columns is-mobile">\n          <div class="column is-narrow">\n            ${c.isSuccessful?'<i class="fas fa-fw fa-check has-text-success" aria-label="Yes"></i>':'<i class="fas fa-fw fa-times has-text-danger" aria-label="No"></i>'}\n          </div>\n          <div class="column">\n            ${u.toLocaleDateString()} ${u.toLocaleTimeString()}<br />\n            <span class="is-size-7">\n              <strong>${null!==(e=c.responseType)&&void 0!==e?e:"(No Response)"}</strong><br />\n              <span class="has-tooltip-right" data-tooltip="Call Out List">\n                <i class="fas fa-fw fa-list" aria-hidden="true"></i>\n                ${cityssm.escapeHTML(null!==(t=c.listName)&&void 0!==t?t:"")}\n              </span><br />\n              <span class="has-tooltip-right" data-tooltip="Nature of Call Out">\n                <i class="fas fa-fw fa-info-circle" aria-hidden="true"></i>\n                ${cityssm.escapeHTML(null!==(l=c.natureOfCallOut)&&void 0!==l?l:"")}\n              </span><br />\n              <span class="has-tooltip-right" data-tooltip="Comment">\n                <i class="fas fa-fw fa-comment" aria-hidden="true"></i>\n                ${cityssm.escapeHTML(null!==(s=c.recordComment)&&void 0!==s?s:"")}\n              </span>\n            </span>\n          </div>\n          <div class="column is-narrow">\n            ${f&&(y||c.recordCreate_userName===b)?'<div class="field has-addons">\n                  <div class="control">\n                    <button class="button is-update-button" data-tooltip="Edit Record">\n                      <i class="fas fa-pencil-alt" aria-hidden="true"></i>\n                    </button>\n                  </div>\n                  <div class="control">\n                    <button class="button is-delete-button" data-tooltip="Delete Record">\n                      <i class="fas fa-trash has-text-danger" aria-hidden="true"></i>\n                    </button>\n                  </div>\n                  </div>':""}\n          </div>\n          </div>`,null===(a=d.querySelector(".is-update-button"))||void 0===a||a.addEventListener("click",O),null===(n=d.querySelector(".is-delete-button"))||void 0===n||n.addEventListener("click",S),r.append(d)}o.innerHTML="",o.append(r)}cityssm.openHtmlModal("callOuts-member",{onshow(e){var i,c,d,m,v,y,b,S,O,L,C,N;u=e;const h=`${a.employeeSurname}, ${a.employeeGivenName}`;e.querySelector(".modal-card-title").textContent=h,e.querySelector("#callOutListMember--listName").textContent=l.listName,e.querySelector("#callOutListMember--employeeName").textContent=h,e.querySelector("#callOutListMember--employeeNumber").textContent=a.employeeNumber,e.querySelector("#callOutListMember--sortKey").textContent=null!==(i=a.sortKey)&&void 0!==i?i:"",e.querySelector("#callOutListMember--listPosition").textContent=`${s+1} / ${r.length}`,void 0!==n&&(null===(c=e.querySelector("#callOutListMember--absenceRecord"))||void 0===c||c.insertAdjacentHTML("afterbegin",`<div class="box mb-3 has-background-warning-light">\n              <div class="columns is-mobile">\n                <div class="column is-narrow" data-tooltip="Absence Record">\n                  <i class="fas fa-sign-out-alt" aria-hidden="true"></i>\n                </div>\n                <div class="column">\n                  ${new Date(n.absenceDateTime).toLocaleDateString()}<br />\n                  ${n.absenceType}\n                </div>\n              </div>\n              </div>`)),f?(e.querySelector("#callOutListMember--workContact1").textContent=null!==(d=a.workContact1)&&void 0!==d?d:"",e.querySelector("#callOutListMember--workContact2").textContent=null!==(m=a.workContact2)&&void 0!==m?m:"",e.querySelector("#callOutListMember--homeContact1").textContent=null!==(v=a.homeContact1)&&void 0!==v?v:"",e.querySelector("#callOutListMember--homeContact2").textContent=null!==(y=a.homeContact2)&&void 0!==y?y:""):(null===(S=null===(b=e.querySelector('a[href$="tab--callNow"]'))||void 0===b?void 0:b.closest("li"))||void 0===S||S.remove(),null===(O=e.querySelector("#tab--callNow"))||void 0===O||O.remove(),null===(C=null===(L=e.querySelector('a[href$="tab--recentCalls"]'))||void 0===L?void 0:L.closest("li"))||void 0===C||C.classList.add("is-active"),null===(N=e.querySelector("#tab--recentCalls"))||void 0===N||N.classList.remove("is-hidden")),cityssm.postJSON(`${o.urlPrefix}/attendance/doGetCallOutRecords`,{listId:l.listId,employeeNumber:t},e=>{p=e.callOutRecords,g()})},onshown(t,n){if(bulmaJS.toggleHtmlClipped(),bulmaJS.init(t),f){t.querySelector("#callOutRecordAdd--listId").value=l.listId,t.querySelector("#callOutRecordAdd--employeeNumber").value=a.employeeNumber;const e=t.querySelector("#callOutRecordAdd--responseTypeId");for(const t of m){const l=document.createElement("option");l.value=t.responseTypeId.toString(),l.textContent=t.responseType,e.append(l)}t.querySelector("#form--callOutRecordAdd").addEventListener("submit",v)}const o=t.querySelector("#callOutListMember--next");s+1===r.length?o.disabled=!0:o.addEventListener("click",()=>{const t=r[s+1].employeeNumber;n(),e(t)});const i=t.querySelector("#callOutListMember--previous");0===s?i.disabled=!0:i.addEventListener("click",()=>{const t=r[s-1].employeeNumber;n(),e(t)})},onhidden(){bulmaJS.toggleHtmlClipped()}})}(e.currentTarget.dataset.employeeNumber)}const g={callOutLists:u,openCallOutList:function(e,t){i=e,r=[];let l,s=[],a=[];const n=d();let m;function y(e){if(e.preventDefault(),!S)return void bulmaJS.alert({title:"Access Denied",message:"You do not have permission to update call out lists.",contextualColorName:"danger"});const l=e.currentTarget.querySelector('button[type="submit"]');l.disabled=!0,l.classList.add("is-loading"),cityssm.postJSON(`${o.urlPrefix}/attendance/doUpdateCallOutList`,e.currentTarget,e=>{const s=e;l.disabled=!1,l.classList.remove("is-loading"),s.success?(bulmaJS.alert({message:"Call out list updated successfully.",contextualColorName:"success"}),m.querySelector(".modal-card-title").textContent=m.querySelector("#callOutListEdit--listName").value,r=s.callOutListMembers,a=s.availableEmployees,L(),g(),u=s.callOutLists,o.callOuts.callOutLists=s.callOutLists,void 0!==t&&t()):bulmaJS.alert({title:"Error Updating Call Out List",message:"Please try again.",contextualColorName:"danger"})})}function b(e){e.preventDefault();const l=e.currentTarget.dataset.employeeNumber;cityssm.postJSON(`${o.urlPrefix}/attendance/doAddCallOutListMember`,{listId:n.listId,employeeNumber:l},e=>{const l=e;l.success?(r=l.callOutListMembers,L(),g(),n.callOutListMembersCount=r.length,void 0!==t&&t()):bulmaJS.alert({title:"Error Adding Member",message:"Please try again.",contextualColorName:"danger"})})}function f(e){var l;e.preventDefault();const s=null!==(l=e.currentTarget.dataset.employeeNumber)&&void 0!==l?l:"";bulmaJS.confirm({title:"Remove Employee from Call Out List",message:`Are you sure you want to remove employee ${s} from the list?`,contextualColorName:"warning",okButton:{text:"Yes, Remove Them",callbackFunction:function(){cityssm.postJSON(`${o.urlPrefix}/attendance/doDeleteCallOutListMember`,{listId:n.listId,employeeNumber:s},e=>{const l=e;l.success?(r=l.callOutListMembers,L(),g(),n.callOutListMembersCount=r.length,void 0!==t&&t()):bulmaJS.alert({title:"Error Removing Member",message:"Please try again.",contextualColorName:"danger"})})}}})}function g(){var e;if(!S)return;const t=m.querySelector("#container--callOutListAvailableEmployees"),l=document.createElement("div");l.className="panel";e:for(const t of a){if(s.includes(t.employeeNumber))continue;const a=m.querySelector("#filter--callOutListAvailableEmployees").value.trim().toLowerCase().split(" "),n=`${t.employeeGivenName} ${t.employeeSurname}`.toLowerCase();for(const e of a)if(!n.includes(e))continue e;const o=document.createElement("a");o.className="panel-block",o.href="#",o.dataset.employeeNumber=t.employeeNumber,o.innerHTML=`<span class="panel-icon">\n          <i class="fas fa-plus" aria-hidden="true"></i>\n          </span>\n          <div>\n            <strong>\n            ${t.employeeSurname},\n            ${t.employeeGivenName}\n            </strong><br />\n            <span class="is-size-7">${null!==(e=t.jobTitle)&&void 0!==e?e:""}</span>\n          </div>`,o.addEventListener("click",b),l.append(o)}l.hasChildNodes()?(t.innerHTML="",t.append(l)):t.innerHTML='<div class="message is-info is-small">\n            <p class="message-body">There are no employees available to add.</p>\n          </div>'}function L(){var e;const t=m.querySelector("#container--callOutListMembers"),l=m.querySelector("#container--callOutListCurrentMembers");if(s=[],0===r.length)return t.innerHTML=`<div class="message is-warning">\n            <p class="message-body">The "${n.listName}" call out list does not include any active employees.</p>\n          </div>`,void(l.innerHTML='<div class="message is-warning is-small">\n            <p class="message-body">No active employees.</p>\n          </div>');const a=document.createElement("div");let o;a.className="panel",S&&((o=document.createElement("div")).className="panel");for(const t of r){const l=c.find(e=>t.employeeNumber===e.employeeNumber),n=document.createElement("a");if(n.className="panel-block is-block",n.href="#",n.dataset.employeeNumber=t.employeeNumber,n.innerHTML=`<div class="columns is-mobile">\n          <div class="column is-narrow">\n          ${void 0===l?'<i class="fas fa-fw fa-hard-hat" aria-hidden="true"></i>':'<i class="fas fa-fw fa-sign-out-alt has-text-warning-dark" aria-hidden="true"></i>'}\n          </div>\n          <div class="column">\n            <strong>\n              ${t.employeeSurname},\n              ${t.employeeGivenName}\n            </strong><br />\n            <span class="is-size-7">${t.employeeNumber}</span>\n          </div>\n          <div class="column">\n            <span class="is-size-7 has-tooltip-left" data-tooltip="Sort Key">\n              <i class="fas fa-sort-alpha-down" aria-hidden="true"></i>\n              ${null!==(e=t.sortKey)&&void 0!==e?e:""}\n            </span><br />\n            <span class="is-size-7 has-tooltip-left" data-tooltip="Last Call Out Time">\n              <i class="fas fa-phone-volume" aria-hidden="true"></i>\n              ${null===t.callOutDateTimeMax?"(No Recent Call Out)":new Date(t.callOutDateTimeMax).toLocaleDateString()}\n            </span>\n          </div>\n          </div>`,n.addEventListener("click",O),a.append(n),!S||void 0===o)continue;s.push(t.employeeNumber);const i=document.createElement("a");i.className="panel-block",i.href="#",i.dataset.employeeNumber=t.employeeNumber,i.innerHTML=`<span class="panel-icon">\n          <i class="fas fa-minus" aria-hidden="true"></i>\n          </span>\n          <div>\n            <strong>${t.employeeSurname}, ${t.employeeGivenName}</strong>\n          </div>`,i.addEventListener("click",f),o.append(i)}t.innerHTML="",t.append(a),S&&void 0!==o&&(l.innerHTML="",l.append(o))}function C(s){s.preventDefault(),bulmaJS.confirm({title:"Delete Call Out List",message:"Are you sure you want to delete this call out list?",contextualColorName:"warning",okButton:{text:"Yes, Delete Call Out List",callbackFunction:function(){cityssm.postJSON(`${o.urlPrefix}/attendance/doDeleteCallOutList`,{listId:e},e=>{const s=e;s.success&&(cityssm.disableNavBlocker(),l(),bulmaJS.alert({message:"Call Out List deleted successfully."}),u=s.callOutLists,o.callOuts.callOutLists=s.callOutLists,void 0!==t&&t())})}}})}cityssm.openHtmlModal("callOuts-list",{onshow(e){var t,l,s;if(m=e,e.querySelector(".modal-card-title").textContent=n.listName,S){null===(t=e.querySelector(".tabs a[href$='tab--callOutMembers-manage']"))||void 0===t||t.classList.remove("is-hidden");const s=e.querySelector(".is-delete-call-out-list");null===(l=s.closest(".dropdown"))||void 0===l||l.classList.remove("is-hidden"),s.addEventListener("click",C)}else null===(s=e.querySelector("#tab--callOuts-members > .tabs"))||void 0===s||s.remove();!function(){var e,t,l,s,a,o,i,r,c,u,d;m.querySelector("#callOutListEdit--listId").value=n.listId,m.querySelector("#callOutListEdit--listName").value=n.listName,m.querySelector("#callOutListEdit--listDescription").value=null!==(e=n.listDescription)&&void 0!==e?e:"",m.querySelector("#callOutListEdit--allowSelfSignUp").value=null!==(t=n.allowSelfSignUp)&&void 0!==t&&t?"1":"0",m.querySelector("#callOutListEdit--selfSignUpKey").value=null!==(l=n.selfSignUpKey)&&void 0!==l?l:"";let b=!1;const f=m.querySelector("#callOutListEdit--eligibilityFunction");for(const e of p){const t=document.createElement("option");t.value=e,t.textContent=e,e===n.eligibilityFunction&&(t.selected=!0,b=!0),f.append(t)}if(!b&&""!==(null!==(s=n.eligibilityFunction)&&void 0!==s?s:"")){const e=document.createElement("option");e.value=null!==(a=n.eligibilityFunction)&&void 0!==a?a:"",e.textContent=null!==(o=n.eligibilityFunction)&&void 0!==o?o:"",e.selected=!0,f.append(e)}let O=!1;const g=m.querySelector("#callOutListEdit--sortKeyFunction");for(const e of v){const t=document.createElement("option");t.value=e,t.textContent=e,e===n.sortKeyFunction&&(t.selected=!0,O=!0),g.append(t)}if(!O&&""!==(null!==(i=n.sortKeyFunction)&&void 0!==i?i:"")){const e=document.createElement("option");e.value=null!==(r=n.sortKeyFunction)&&void 0!==r?r:"",e.textContent=null!==(c=n.sortKeyFunction)&&void 0!==c?c:"",e.selected=!0,g.append(e)}if(m.querySelector("#callOutListEdit--employeePropertyName").value=null!==(u=n.employeePropertyName)&&void 0!==u?u:"",S){const e=m.querySelector("#callOutListEdit--unlockButtons");e.classList.remove("is-hidden"),null===(d=e.querySelector("button"))||void 0===d||d.addEventListener("click",()=>{var t;e.remove(),null===(t=m.querySelector("#callOutListEdit--updateButtons"))||void 0===t||t.classList.remove("is-hidden");const l=m.querySelector("#form--callOutListEdit");l.addEventListener("submit",y),l.querySelector("fieldset").disabled=!1})}}(),cityssm.postJSON(`${o.urlPrefix}/attendance/doGetCallOutListMembers`,{listId:n.listId,includeAvailableEmployees:S},e=>{var t;const l=e;r=l.callOutListMembers,a=l.availableEmployees,c=l.absenceRecords,L(),g(),null===(t=m.querySelector("#filter--callOutListAvailableEmployees"))||void 0===t||t.addEventListener("keyup",g)})},onshown(t,s){l=s,bulmaJS.toggleHtmlClipped(),bulmaJS.init(t),o.initializeMenuTabs(t.querySelectorAll(".menu a"),t.querySelectorAll(".tabs-container > article")),t.querySelector("#reportingLink--callOutListReport").href=`${o.urlPrefix}/print/screen/callOutList/?listIds=${e}`,t.querySelector("#reportingLink--callOutListMembersCSV").href=`${o.urlPrefix}/reports/callOutListMembers-formatted-byListId/?listId=${e}`,t.querySelector("#reportingLink--callOutRecordsCSV").href=`${o.urlPrefix}/reports/callOutRecords-recent-byListId/?listId=${e}`,cityssm.enableNavBlocker()},onhidden(){bulmaJS.toggleHtmlClipped(),cityssm.disableNavBlocker(),i="",r=[]}})}};exports.Attend.callOuts=g})();