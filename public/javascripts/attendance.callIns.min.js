"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=exports.Attend,t=exports.absenceTypes,n=exports.employees,o=exports.employeeNumberRegularExpression,s=exports.absencesCanUpdate,r=exports.returnsToWorkCanUpdate;let a=exports.absenceRecords,l=exports.returnToWorkRecords;function c(t){const n=t.currentTarget.closest(".panel-block").dataset.recordId;bulmaJS.confirm({title:"Delete Absence Record",message:"Are you sure you want to delete this absence record?",contextualColorName:"warning",okButton:{text:"Yes, Delete Record",callbackFunction:function(){cityssm.postJSON(`${e.urlPrefix}/attendance/doDeleteAbsenceRecord`,{recordId:n},e=>{var t;const n=e;n.success?(bulmaJS.alert({message:"Absence record deleted successfully.",contextualColorName:"success"}),a=n.absenceRecords,d()):bulmaJS.alert({title:"Error Deleting Record",message:null!==(t=n.errorMessage)&&void 0!==t?t:"",contextualColorName:"danger"})})}}})}function d(){var e,t,n,o,s;const r=document.querySelector("#container--absences");if(null===r)return;if(0===a.length)return void(r.innerHTML='<div class="message is-info">\n        <p class="message-body">There are no recent absence records to show.</p>\n        </div>');const l=document.createElement("div");l.className="panel";let d=0;for(const r of a){const a=new Date(r.absenceDateTime),i=document.createElement("div");i.className="panel-block is-block",i.dataset.recordId=r.recordId,i.tabIndex=0,Date.now()-a.getTime()<=864e5&&(i.classList.add("has-background-success-light"),d+=1),i.innerHTML=`<div class="columns is-mobile">\n        <div class="column is-narrow">\n          <i class="fas fa-sign-out-alt" aria-hidden="true"></i>\n        </div>\n        <div class="column is-3">\n          <strong data-tooltip="Absence Date">\n            ${a.toLocaleDateString()}\n          </strong>\n        </div>\n        <div class="column is-4">\n          <strong>${r.employeeName}</strong><br />\n          <span class="is-size-7">${null!==(e=r.employeeNumber)&&void 0!==e?e:""}</span>\n        </div>\n        <div class="column">\n          <strong data-tooltip="Absence Type">${null!==(t=r.absenceType)&&void 0!==t?t:r.absenceTypeKey}</strong><br />\n          <span class="is-size-7">${null!==(n=r.recordComment)&&void 0!==n?n:""}</span>\n        </div>\n        </div>`,r.canUpdate&&(null===(o=i.querySelector(".columns"))||void 0===o||o.insertAdjacentHTML("beforeend",'<div class="column is-narrow">\n            <button class="button is-small is-inverted is-danger has-tooltip-left is-delete-button" data-tooltip="Delete Record" data-cy="delete" type="button" aria-label="Delete Record">\n              <i class="fas fa-trash" aria-hidden="true"></i>\n            </button>\n          </div>'),null===(s=i.querySelector(".is-delete-button"))||void 0===s||s.addEventListener("click",c)),l.append(i)}r.innerHTML="",r.append(l),document.querySelector('#menu--attendance a[href="#tab--absences"] .tag').textContent=d.toString()}function i(t){const n=t.currentTarget.closest(".panel-block").dataset.recordId;bulmaJS.confirm({title:"Delete Return to Work Record",message:"Are you sure you want to delete this return to work record?",contextualColorName:"warning",okButton:{text:"Yes, Delete Record",callbackFunction:function(){cityssm.postJSON(`${e.urlPrefix}/attendance/doDeleteReturnToWorkRecord`,{recordId:n},e=>{var t;const n=e;n.success?(bulmaJS.alert({message:"Return to work record deleted successfully.",contextualColorName:"success"}),l=n.returnToWorkRecords,u()):bulmaJS.alert({title:"Error Deleting Record",message:null!==(t=n.errorMessage)&&void 0!==t?t:"",contextualColorName:"danger"})})}}})}function u(){var e,t,n,o,s;const r=document.querySelector("#container--returnsToWork");if(null===r)return;if(0===l.length)return void(r.innerHTML='<div class="message is-info">\n        <p class="message-body">There are no recent return to work records to show.</p>\n        </div>');const a=document.createElement("div");a.className="panel";let c=0;for(const r of l){const l=new Date(r.returnDateTime),d=document.createElement("div");d.className="panel-block is-block",d.dataset.recordId=r.recordId,d.tabIndex=0,Date.now()-l.getTime()<=864e5&&(d.classList.add("has-background-success-light"),c+=1),d.innerHTML=`<div class="columns is-mobile">\n        <div class="column is-narrow">\n          <i class="fas fa-sign-in-alt" aria-hidden="true"></i>\n        </div>\n        <div class="column is-3">\n          <strong data-tooltip="Return Date">${l.toLocaleDateString()}</strong>\n        </div>\n        <div class="column is-4">\n          <strong>${r.employeeName}</strong><br />\n          <span class="is-size-7">${null!==(e=r.employeeNumber)&&void 0!==e?e:""}</span>\n        </div>\n        <div class="column">\n          <strong data-tooltip="Return Shift">${null!==(t=r.returnShift)&&void 0!==t?t:"(No Shift)"}</strong><br />\n          <span class="is-size-7">${null!==(n=r.recordComment)&&void 0!==n?n:""}</span>\n        </div>\n        </div>`,r.canUpdate&&(null===(o=d.querySelector(".columns"))||void 0===o||o.insertAdjacentHTML("beforeend",'<div class="column is-narrow">\n              <button class="button is-small is-inverted is-danger has-tooltip-left is-delete-button" data-tooltip="Delete Record" data-cy="delete" type="button" aria-label="Delete Record">\n                <i class="fas fa-trash" aria-hidden="true"></i>\n              </button>\n            </div>'),null===(s=d.querySelector(".is-delete-button"))||void 0===s||s.addEventListener("click",i)),a.append(d)}r.innerHTML="",r.append(a),document.querySelector('#menu--attendance a[href="#tab--returnsToWork"] .tag').textContent=c.toString()}function m(c){var i;let m,p;const b=null!==(i=c.currentTarget.dataset.callInType)&&void 0!==i?i:"";let v="";function y(){const e=m.querySelector("#callInAdd--employeeNumber"),t=e.value.toLowerCase();if(t===v)return;v=t;const o=m.querySelector("#callInAdd--employeeName");o.value="";const s=n.filter(e=>t.length>=e.employeeNumber.length/2&&e.employeeNumber.toLowerCase().endsWith(t));1===s.length&&(e.value=s[0].employeeNumber,v=s[0].employeeNumber.toLowerCase(),o.value=`${s[0].employeeGivenName} ${s[0].employeeSurname}`.trim())}function g(){const e=m.querySelectorAll('input[name="callInType"]');for(const t of e){const e=t.closest("label"),n=m.querySelector(`fieldset[data-call-in-type="${t.value}"]`);t.checked?(e.classList.add("is-link"),e.querySelector(".icon").innerHTML='<i class="fas fa-check" aria-hidden="true"></i>',n.disabled=!1,n.classList.remove("is-hidden")):(e.classList.remove("is-link"),e.querySelector(".icon").innerHTML='<i class="fas fa-minus" aria-hidden="true"></i>',n.classList.add("is-hidden"),n.disabled=!0)}}function f(t){t.preventDefault(),cityssm.postJSON(`${e.urlPrefix}/attendance/doRecordCallIn`,t.currentTarget,e=>{const t=e;t.success&&(p(),"absence"===t.callInType?(a=t.absenceRecords,d()):"returnToWork"===t.callInType&&(l=t.returnToWorkRecords,u()))})}cityssm.openHtmlModal("callIn-add",{onshow(e){var n,o;if(m=e,s){e.querySelector("#callInAdd--absenceDateString-absence").valueAsDate=new Date;const n=e.querySelector("#callInAdd--absenceTypeKey-absence");for(const e of t){const t=document.createElement("option");t.value=e.absenceTypeKey,t.textContent=e.absenceType,n.append(t)}}else null===(n=e.querySelector("#callInAdd--callInType_absence"))||void 0===n||n.remove();r?e.querySelector("#callInAdd--returnDateString-returnToWork").valueAsDate=new Date:null===(o=e.querySelector("#callInAdd--callInType_returnToWork"))||void 0===o||o.remove(),""!==b&&(e.querySelector(`#callInAdd--callInType_${b}`).checked=!0,g())},onshown(e,t){var n,s,r;p=t,bulmaJS.toggleHtmlClipped(),null===(n=e.querySelector("form"))||void 0===n||n.addEventListener("submit",f);const a=e.querySelector("#callInAdd--employeeNumber");void 0!==o&&(a.pattern=o.source),a.focus(),a.addEventListener("keyup",y),null===(s=e.querySelector("#callInAdd--callInType_absence"))||void 0===s||s.addEventListener("change",g),null===(r=e.querySelector("#callInAdd--callInType_returnToWork"))||void 0===r||r.addEventListener("change",g)},onremoved(){bulmaJS.toggleHtmlClipped()}})}if(s||r){const e=document.querySelectorAll(".is-new-call-in-button");for(const t of e)t.addEventListener("click",m)}d(),u()})();